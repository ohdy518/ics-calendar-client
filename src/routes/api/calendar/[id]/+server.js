import { error } from '@sveltejs/kit';

const calendars = {
	'yhims-g9-2025': `BEGIN:VCALENDAR
VERSION:2.0
PRODID:-//YoonsungOh//YHIMS G9 2025/2//KR
BEGIN:VEVENT
SUMMARY:중간고사
DTSTART;TZID=Asia/Seoul:20251020T075000
DTEND;TZID=Asia/Seoul:20251022T112000
DTSTAMP:20250920T032025Z
UID:eddc5345-81a3-47c3-8271-0a059d6279a5
PRIORITY:5
END:VEVENT
BEGIN:VEVENT
SUMMARY:중간고사 기출 평가지 공개
DTSTART;TZID=Asia/Seoul:20251013T090000
DTEND;TZID=Asia/Seoul:20251017T080000
DTSTAMP:20250920T032025Z
UID:ef59d10d-618e-4576-9607-a98166992f94
PRIORITY:6
END:VEVENT
BEGIN:VEVENT
SUMMARY:스포츠 캠프
DTSTART;TZID=Asia/Seoul:20251001T083000
DTEND;TZID=Asia/Seoul:20251002T160000
DTSTAMP:20250920T032025Z
UID:9eea79ab-bb77-4ae5-a061-d2e682ea96f5
PRIORITY:5
END:VEVENT
BEGIN:VEVENT
SUMMARY:졸업 여행
DTSTART;VALUE=DATE:20251110
DTEND;VALUE=DATE:20251113
DTSTAMP:20250920T032025Z
UID:da6ddb3f-9160-4e27-a06f-2dea0bd5a5d3
PRIORITY:5
END:VEVENT
BEGIN:VEVENT
SUMMARY:크리스마스 콘서트
DTSTART;VALUE=DATE:20251215
DTEND;VALUE=DATE:20251216
DTSTAMP:20250920T032025Z
UID:99cca26f-20d3-42e7-b7b8-bb4697174003
PRIORITY:5
END:VEVENT
BEGIN:VEVENT
SUMMARY:재량휴업일
DTSTART;VALUE=DATE:20251010
DTEND;VALUE=DATE:20251011
DTSTAMP:20250920T032025Z
UID:3700806d-2f67-42b2-933d-253e91375ec5
PRIORITY:5
END:VEVENT
BEGIN:VEVENT
SUMMARY:재량휴업일
DTSTART;VALUE=DATE:20251114
DTEND;VALUE=DATE:20251115
DTSTAMP:20250920T032025Z
UID:a7f55720-72d8-4af6-bcbc-f86448f848e9
PRIORITY:5
END:VEVENT
BEGIN:VTIMEZONE
TZID:Asia/Seoul
COMMENT:This timezone only works from 1970-01-01 to 2038-01-01.
BEGIN:STANDARD
DTSTART:19700101T000000
TZNAME:KST
TZOFFSETFROM:+0900
TZOFFSETTO:+0900
END:STANDARD
BEGIN:DAYLIGHT
DTSTART:19870510T030000
RDATE:19880508T030000
TZNAME:KDT
TZOFFSETFROM:+0900
TZOFFSETTO:+1000
END:DAYLIGHT
BEGIN:STANDARD
DTSTART:19871011T030000
RDATE:19881009T030000
TZNAME:KST
TZOFFSETFROM:+1000
TZOFFSETTO:+0900
END:STANDARD
END:VTIMEZONE
END:VCALENDAR`
};

export async function GET({ params }) {
	const { id } = params;
	
	if (!calendars[id]) {
		throw error(404, 'Calendar not found');
	}
	
	try {
		const icsContent = calendars[id];
		
		return new Response(icsContent, {
			headers: {
				'Content-Type': 'text/calendar; charset=utf-8',
				'Content-Disposition': `attachment; filename="${id}.ics"`,
				'Cache-Control': 'public, max-age=3600',
				'Access-Control-Allow-Origin': '*',
				'Access-Control-Allow-Methods': 'GET',
				'Access-Control-Allow-Headers': 'Content-Type'
			}
		});
	} catch (err) {
        console.log(err)
		throw error(500, `Failed to read calendar file: ${err}`);
	}
}